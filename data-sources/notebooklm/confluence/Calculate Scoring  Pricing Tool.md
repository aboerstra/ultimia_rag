# Calculate Scoring & Pricing Tool

*Source: Confluence | Page ID: 3383918595*
*Last Updated: 2025-10-06T14:20:00.688Z by Laura Dolphin*

---

<h1>Deal Scoring</h1><p>AltScore (partner of KinAnalytics)</p><h2>User Process</h2><p>Opportunity&gt;Calculate Score. </p><p>Process pushes data from the Opportunity, key Contact Roles, credit scores of those Contacts, and Collateral data to AltScore and runs it through one of the relevant scoring models to produce back a recommended Score on whether to proceed with the deal or not based on if the model thinks the parameters of the Deal &amp; Debtors/Lessees will be too risky or not.</p><p>When button is clicked, it gets data from the Opportunity and related vehicles and sends to the altscore endpoint. From here, the KinAnalytics API takes over and runs data for the provided info and creates a Scoring Record on the Opportunity with populated data. This process can be repeated after updates to the Opps, additional collateral added to see if we can increase the Score for the Applicant and get the Score Decision to approved. </p><ac:image ac:align="center" ac:layout="center" ac:original-height="272" ac:original-width="1517" ac:custom-width="true" ac:alt="image-20241112-142942.png" ac:width="760"><ri:attachment ri:filename="image-20241112-142942.png" ri:version-at-save="1" /></ac:image><ac:image ac:align="center" ac:layout="center" ac:original-height="450" ac:original-width="949" ac:custom-width="true" ac:alt="image-20241112-143406.png" ac:width="760"><ri:attachment ri:filename="image-20241112-143406.png" ri:version-at-save="1" /></ac:image><p>The Scoring Record stores the URL to the altscore dashboard to see more info and the data from altscore dashboard populates the Scoring record:</p><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="333" ac:original-width="1494" ac:custom-width="true" ac:alt="image-20241112-143637.png" ac:width="760"><ri:attachment ri:filename="image-20241112-143637.png" ri:version-at-save="1" /></ac:image><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="650" ac:original-width="961" ac:custom-width="true" ac:alt="image-20241112-143707.png" ac:width="760"><ri:attachment ri:filename="image-20241112-143707.png" ri:version-at-save="1" /></ac:image><h2>Backend Process</h2><p>Authentication via a Connected App in Salesforce: KinAnalytics</p><p>Integration User: <a href="https://fbsg.sharepoint.com/:w:/r/_layouts/15/Doc.aspx?sourcedoc=%7BDE5046CD-C047-43C1-845A-55E05229F89D%7D&amp;file=SF%20Scoring%20Int%20Users.docx&amp;action=default&amp;mobileredirect=true">Scoring Integration </a></p><p>Calculate Score button calls:</p><p>Visualforce CreateScoring</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="a2561f56-46c7-4e0b-a45d-563de1f5a599"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:plain-text-body><![CDATA[<apex:page standardController="Opportunity" extensions="CreditController" action="{!createScoring}">
<apex:form >
<apex:inputHidden value="{!Opportunity.Id}"/>
</apex:form>
</apex:page>]]></ac:plain-text-body></ac:structured-macro><p>Apex Class CreditController</p><ac:structured-macro ac:name="code" ac:schema-version="1" ac:macro-id="1a6ced69-cd55-4874-a141-a264f2656351"><ac:parameter ac:name="breakoutMode">wide</ac:parameter><ac:parameter ac:name="breakoutWidth">760</ac:parameter><ac:plain-text-body><![CDATA[public class CreditController {
    public Id Id { get; set; }
    public Opportunity opp { get; set; }

    //constructor to get the Opportunity record
    public CreditController(ApexPages.StandardController controller) {
    opp =  (Opportunity) controller.getRecord();
    Id = opp.Id;
    }

    public PageReference createScoring() {
        KinAnalyticsAPI api = new KinAnalyticsAPI();
        String json = api.getScoringRecordString(Id);

        if(json != '')
        {
            List<Scoring__c> scores = api.parseJsonString(json);
            system.debug(scores);
            Insert scores;
        }
        PageReference pageRef = new PageReference('/'+Id);
        pageRef.setRedirect(true);
        return pageRef; //Returns to the case page
    }

}]]></ac:plain-text-body></ac:structured-macro><p /><p><a href="https://maximcc.lightning.force.com/lightning/setup/ApexClasses/page?address=%2F01p3k000008VkTd">Apex Class KinAnalyticsAPI</a></p><ol start="1"><li><p>Gets fields from Opportunity:<br />Opportunity opp = [SELECT </p></li></ol><p>                Id,</p><p>                Name,         </p><p>                CreatedDate,</p><p>                Down_Payment__c,</p><p>                Amount,</p><p>                Term__c,</p><p>                Actual_Term__c,</p><p>                CALCAP__c,</p><p>                TIB__c,</p><p>                NIL__c,</p><p>                Broker__c,</p><p>                Dealer__c,</p><p>                Years_with_a_CDL__c,</p><p>                Broker__r.Broker_s_California_Financing_Law_Licens__c,</p><p>                Broker_s_Level_of_Acceptance__c,</p><p>                Dealer_s_Level_of_Acceptance__c,       </p><p>                RecordTypeId</p><p>              FROM Opportunity </p><p>              WHERE Id = :id LIMIT 1];</p><p style="margin-left: 60.0px;">RecordType Name</p><ol start="2"><li><p>POSTS to Endpoint <code>https://se.altscore.ai/se/maximcc/mcs1/v3/score</code> with API key in class. Sets the body as json.</p></li><li><p>Gets Vehicles relates to Opportunity and converts these into json Assets in a list: List:</p><p>                      Id,Mileage__c,Year__c,Description__c,Engine__c,Axle__c,Name,Make__c,Model__c,VIN__c,Transmission_Type__c,</p><p>                        Sleeper__c,Hours__c,Serial_Number__c, Classification__c, ModelName__r.ClassificationId__c,</p><p>                Category__c, ModelName__r.CategoryID__c, Manufacturer__r.Name, Manufacturer__r.ManufacturerId__c,</p><p>                ModelName__r.Name, ModelName__r.ModelId__c,Other_Asset_Type__c                </p><p>                    FROM Vehicles__c </p><p>                    WHERE Opportunity_Name__c = :opp.Id];</p></li></ol><p>if there are no vehicles, User will get error 'Could not calculate score due to missing vehicle information.'</p><p /><p>Then, it gets the Opportunity Contact Roles - it gets the Contact ID, Mailing State &amp; Role. It gets all with </p><p>The roles are then categorized into three different lists based on their role type:</p><p>    Debtors: Contacts with the role '<strong>debtor</strong>'.</p><p>    Co-debtors: Contacts with the role '<strong>co-debto</strong>r'.</p><p>    Guarantors: Contacts with the role '<strong>guarantor</strong>'.</p><p>It then puts these roles into a list and converts into json</p><p /><p>For each Contact, it retrieves if available (ordered by Created Date DESC) the LASERCA__Personal_Credit_Report__c</p><p /><h1>Pricing Tool / Deal Structuring Tool</h1><p><a href="https://maximpricingtool.com/">Maximpricingtool.com</a> (login required)</p><p>Custom application built by KinAnalytics for Maxim that helps price deals and calculates how much Maxim might lose on a deal so what they should price the deal at to make money. This works with their risk i.e. likeliness to default.</p><h2>User Process</h2><p>Maxim is having Kin build the logic so that the most recent pricing record populates back onto the Scoring record. <ac:emoticon ac:name="warning" ac:emoji-shortname=":warning:" ac:emoji-id="atlassian-warning" ac:emoji-fallback=":warning:" /> Note the NIL on the Pricing Tool should equal the NIL on the Opportunity. This is done manually by the Credit Underwriter (SF User) but this is also calculated or used by/in Tvalue. This is due to become automated.</p><ac:image ac:align="center" ac:layout="center" ac:original-height="538" ac:original-width="1386" ac:custom-width="true" ac:alt="image-20241112-143834.png" ac:width="760"><ri:attachment ri:filename="image-20241112-143834.png" ri:version-at-save="1" /></ac:image><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="638" ac:original-width="980" ac:custom-width="true" ac:alt="image-20241112-143926.png" ac:width="760"><ri:attachment ri:filename="image-20241112-143926.png" ri:version-at-save="1" /></ac:image><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="736" ac:original-width="1236" ac:custom-width="true" ac:alt="image-20241112-144001.png" ac:width="760"><ri:attachment ri:filename="image-20241112-144001.png" ri:version-at-save="1" /></ac:image><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="654" ac:original-width="1014" ac:custom-width="true" ac:alt="image-20241112-144027.png" ac:width="760"><ri:attachment ri:filename="image-20241112-144027.png" ri:version-at-save="1" /></ac:image><p>This data here is populated back onto the Scoring record in Salesforce:</p><ac:image ac:align="center" ac:layout="center" ac:original-height="471" ac:original-width="1258" ac:custom-width="true" ac:alt="image-20241112-144432.png" ac:width="760"><ri:attachment ri:filename="image-20241112-144432.png" ri:version-at-save="1" /></ac:image><p /><p /><h2>Backend Process</h2><p>When the button &ldquo;Structure Deal&rdquo; button is clicked, it redirects to visualforce page <code>GetStructureDealURL</code> which uses the Scoringc standard controller with the <code>ScoringController</code> extension. On load, the action getStructureDealUrl apex method runs.  The action instantiates KinAnalyticsAPI, calls <code>getStructureDealString(Id)</code> to generate a URL on run time basis, updates Structure_Deal_URL__c, saves the record, creates a PageReference to the URL, sets redirect to true, and returns it. In turn the page is redirected to the URL received via KinAnalytics API as response.</p><p>Currently the method getStructureDealString from KinAnalyticsAPI apex class is making request to following endpoint to get the redirection URL, this seems to be same as production hence its generating URL for production instance:</p><p><a href="https://4o0zd9kjt8.execute-api.us-east-1.amazonaws.com/saveDeal"><u>https://4o0zd9kjt8.execute-api.us-east-1.amazonaws.com/saveDeal</u></a></p><p>Above request generating URL for prod instance, maximpricingtool then generating sessionId using production authentication and then using to store the information back in Salesforce. But in case of sandbox, just by replacing the domain to <a href="http://stg.maximpricingtool.com/"><u>http://stg.maximpricingtool.com</u></a> won't work as sessionId which was generated for production is not valid for sandbox.</p><p>Created custom setting &ldquo;<code>Kin_Analytics_API_Config__c</code>&quot; and had two config fields Get Structured Deal Endpoint	 and Get Scoring Endpoint.</p><p>Click Manage to input the relevant endpoints for either production or sandbox.</p><p><code>Get Scoring Endpoint</code> for getting score record and <code>Get Structured Deal Endpoint</code> to get structured deal. Modified apex class: <code>KinAnalyticsAPI</code></p><ac:image ac:align="center" ac:layout="center" ac:original-height="324" ac:original-width="1181" ac:custom-width="true" ac:alt="image-20251006-141957.png" ac:width="760"><ri:attachment ri:filename="image-20251006-141957.png" ri:version-at-save="1" /></ac:image><p />