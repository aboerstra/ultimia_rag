# Tvalue

*Source: Confluence | Page ID: 3466395684*
*Last Updated: 2025-08-07T14:14:57.828Z by Laura Dolphin*

---

<p>TValue / TimeValue was implemented twice: once by Dotsquares <a href="mailto:sandeep.barala@dotsquares.com">sandeep.barala@dotsquares.com</a>, once internally by Youyang.</p><p>There are two pieces of logic in the org:<br /><br />Used: Process Builder: <strong>T-Value Automation</strong> which calls Apex Class: <strong>TvalueAutomated - </strong>Test class: <strong>TimeValueCalculationTriggerTest</strong>. Loads a base XML template from <strong>TimeValueUtility </strong>and Sends XML to <strong>TValueService  (TValueService.tveSoap) </strong>to calculate a financial metric</p><p>Not Used: Opportunity Trigger: <strong>TimeValueCalculationTrigger </strong>which calls Apex Class <strong>TimeValueCalculationDs</strong></p><h1>Business Use Case</h1><p>The automations/integrations with <a href="https://www.timevalue.com/">TimeValue </a>helps with Financial Calculations for Payments to structure a loan repayment schedule. It formats that into XML, sends it to the external TValue service, and updates the Opportunity with the calculated annual yield.</p><p /><h1>T-Value Automation &amp; TvalueAutomated</h1><p><strong>Trigger and Entry Point :</strong></p><p>When an Opportunity is created or updated and any of these fields change:</p><ul><li><p>GPS_Fee__c</p></li><li><p>Documentation_Fee__c</p></li><li><p>Inspection_Fees__c</p></li><li><p>Other_Fees__c</p></li><li><p>Down_Payment__c</p></li><li><p>Payment_Schedule__c</p></li><li><p>Periods__c</p></li><li><p>Warranty_Fee__c</p></li></ul><p>&nbsp;</p><p><strong>Process Execution :</strong></p><p>&nbsp;</p><p>In the Process method, Salesforce retrieves Opportunity records based on the provided IDs, fetching key fields like NIL__c, PMT_Block__c, Term_Block__c, Payment_Schedule__c, and Payment_Type__c.</p><p>The method then determines payment event dates and amounts based on the Opportunity&rsquo;s payment schedule and type (e.g., monthly, weekly, or bi-weekly, in arrears or advance).</p><p>It constructs XML payloads containing event details (e.g., event dates, event types, and amounts) for the TValue Engine.</p><p>&nbsp;</p><p><strong>Tvalue Engine Interaction :</strong></p><p>&nbsp;</p><p>Using the generated XML, the method invokes a third-party web service (presumably TValueService.tveSoap) to calculate values like the Annual_Yield__c based on the Opportunity details.</p><p>The XML specifies different events (Event 8, Event 9) based on payment terms.</p><p>&nbsp;The TValueService web service integration in this code does not explicitly show an authentication setup, such as OAuth or basic HTTP headers for authentication. However, there is a LicenseKey field used as a parameter in the calculate method call (likely acting as a form of key-based authentication with the external service). This would mean that an API key or license key is used for simple authentication with the Tvalue service, but there is no advanced authentication setup shown within this code snippet.</p><p /><ac:image ac:align="center" ac:layout="center" ac:original-height="477" ac:original-width="742" ac:custom-width="true" ac:alt="image-20241113-190715.png" ac:width="742"><ri:attachment ri:filename="image-20241113-190715.png" ri:version-at-save="1" /></ac:image><p /><p><strong>Opportunity Update :</strong></p><p>&nbsp;</p><p>After receiving the calculation result from the Tvalue Engine, the Annual_Yield__c field on the Opportunity is updated with the calculated value.</p><p>This process effectively uses the TValue Engine to derive complex financial values (like yield) based on defined schedules and terms in the Opportunity and saves the result back to the record.</p>